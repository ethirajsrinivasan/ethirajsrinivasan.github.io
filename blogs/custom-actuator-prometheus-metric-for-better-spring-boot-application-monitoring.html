<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>Custom Actuator Prometheus Metric For Better Spring Boot Application Monitoring</title>
		<meta name="description" content="This article describes a elegant way to add custom actuator prometheus metric to spring boot applications. Spring boot, a powerful java based framework to develop micro services web application provides many easy to configure solutions for developers need. Developing a microservices application is complete only when we can monitor these microservices. Spring boot provides Actuator to help monitor these microservices. Actuator uses HTTP endpoints to provide information about the application. Actuator provides lot of metrics like the database connections , thread information, memory information, HTTP client and server requests etc. Below are the 3 steps to add custom actuator prometheus metrics in spring boot"/>
		<meta property="og:image" content="https://images.unsplash.com/photo-1589935447067-5531094415d1"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" href="../assets/application-ec816bccda848783beb46c6fccbb0faa297eddc1e2f7355c14dd909bf8165745.css" media="screen" />
		<link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
		<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
		<link href="https://cdn.rawgit.com/michalsnik/aos/2.1.1/dist/aos.css" rel="stylesheet">
		<script src="../assets/application-802f9fc6b464e394ae64db61e6b0de8cf5f1e9f73e6e5675b06d076f0e16d3c6.js" data-turbolinks-track="true"></script>
		<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="QCmSfqSQuvjcbJGkn2V3HjwM3dMyJ956O2-DZiwzZwPDpqLe4JnoFVLCeJxV6KAzQ9w5L5b5t7K9UMu2LlWfAw" />
		<link rel="icon" type="image/x-icon" href="../assets/favicon-bfc8f965e9c5b25ff8620b94c33011eeaa4a222a73aef252f51d06ee90009e75.ico" />
		<script src="https://cdn.rvlqplr.com/engine/engine-entry.js?pid=0a33716f-efb9-4dac-a8ed-8fae94f49289" async></script>
		<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8495931515801704"
     crossorigin="anonymous"></script>
	</head>
	<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S8HN948EZZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-S8HN948EZZ');
</script>
	<body class="blog_body" data-spy="scroll" data-target="#navbar-scrollspy" data-offset="200">
		<section class="cover text-center" style="background-image: url(https://images.unsplash.com/photo-1589935447067-5531094415d1)">
			<nav class="navbar navbar-expand-lg navbar-trans navbar-light">
				<div class="container-fluid">
					<a class="navbar-brand" href="../index.html"><strong>Ethiraj Srinivasan</strong></a>
					<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
					</button>
					<div class="collapse navbar-collapse" id="navbarNavAltMarkup">
						<div class="navbar-nav ms-auto">
							<a class="nav-link" href="../resume.pdf" target="_blank">Resume</a>
							<a class="nav-link" href="../index.html#portfolio">Portfolio</a>
							<a class="nav-link" href="../blogs.html">Blog</a>
							<a class="nav-link" href="../about.html">About</a>
						</div>
					</div>
				</div>
			</nav>
		</section>
		<br>
<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body><div id="file" class="md" data-path="spring boot custom actuator prometheus metrics.md"><article class="markdown-body entry-content container-lg" itemprop="text"><h2 dir="auto">
<a id="user-content-custom-actuator-prometheus-metric-for-better-spring-boot-application-monitoring" class="anchor" aria-hidden="true" href="custom-actuator-prometheus-metric-for-better-spring-boot-application-monitoring.html#custom-actuator-prometheus-metric-for-better-spring-boot-application-monitoring"><svg class="octicon octicon-link" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Custom Actuator Prometheus Metric For Better Spring Boot Application Monitoring</h2>
<p dir="auto">This article describes a elegant way to add custom actuator prometheus metric to spring boot applications. Spring boot, a powerful java based framework to develop micro services web application provides many easy to configure solutions for developers need. Developing a microservices application is complete only when we can monitor these microservices. Spring boot provides Actuator to help monitor these microservices. Actuator uses HTTP endpoints to provide information about the application. Actuator provides lot of metrics like the database connections , thread information, memory information, HTTP client and server requests etc. Below are the 3 steps to add custom actuator prometheus metrics in spring boot</p>
<p></p>
<div class="rvlqplr-placement-046628aa-40bc-4b18-bb04-e20223f91c38"></div>
<ol dir="auto">
<li>Enable actuator in spring boot application</li>
<li>Add prometheus micrometer to the application</li>
<li>Add custom metrics to micrometer prometheus</li>
</ol>
<br>
<h6 align="center" dir="auto">
<a id="" class="anchor" aria-hidden="true" href="custom-actuator-prometheus-metric-for-better-spring-boot-application-monitoring.html#"><svg class="octicon octicon-link" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>•     •     •</h6>
<br>
<h3 dir="auto">
<a id="user-content-enable-actuator-in-spring-boot-application" class="anchor" aria-hidden="true" href="custom-actuator-prometheus-metric-for-better-spring-boot-application-monitoring.html#enable-actuator-in-spring-boot-application"><svg class="octicon octicon-link" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Enable Actuator in Spring Boot Application</h3>
<p dir="auto">In order to add actuator to the spring boot application add the following to pom.xml</p>
<p dir="auto">For Maven</p>
<div class="highlight highlight-source-java notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="&lt;dependency&gt;
	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
	&lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
&lt;/dependency&gt;"><pre>&lt;<span class="pl-s1">dependency</span>&gt;
	&lt;<span class="pl-s1">groupId</span>&gt;<span class="pl-smi">org</span>.<span class="pl-smi">springframework</span>.<span class="pl-smi">boot</span>&lt;/<span class="pl-smi">groupId</span>&gt;
	&lt;<span class="pl-s1">artifactId</span>&gt;<span class="pl-s1">spring</span>-<span class="pl-s1">boot</span>-<span class="pl-s1">starter</span>-<span class="pl-s1">actuator</span>&lt;/<span class="pl-s1">artifactId</span>&gt;
&lt;/<span class="pl-s1">dependency</span>&gt;</pre></div>
<p dir="auto">Run your spring application using</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="mvn spring-boot:run"><pre>mvn spring-boot:run</pre></div>
<p dir="auto">The application will run on port 8080. Go to <a href="http://localhost:8080/actuator" rel="nofollow">http://localhost:8080/actuator</a> to view the actuator end points.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://user-images.githubusercontent.com/7569031/233104414-32731ea3-a848-4b41-bf13-671fd3a73931.png"><div class="text-center"><img src="https://user-images.githubusercontent.com/7569031/233104414-32731ea3-a848-4b41-bf13-671fd3a73931.png" alt="Actuator End Point" style="max-width: 100%;"></div></a></p>
<p dir="auto">The actuator provides a health check endpoint which shows the status of the application. The status is "UP" if the application is healthy and "DOWN" if there are any issues</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://user-images.githubusercontent.com/7569031/233108139-1bd8bb24-e095-4a07-a5e5-0ba972e79eea.png"><div class="text-center"><img src="https://user-images.githubusercontent.com/7569031/233108139-1bd8bb24-e095-4a07-a5e5-0ba972e79eea.png" alt="Health EndPoint" style="max-width: 100%;"></div></a></p>
<p dir="auto">Actuator does provide more than just the health information. To unlock its true potential expose its endpoint to the outside world. To do this include the following in application.properties</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="management.endpoint.info.enabled=true
management.endpoints.web.exposure.include=*"><pre>management.endpoint.info.enabled=true
management.endpoints.web.exposure.include=<span class="pl-k">*</span></pre></div>
<p dir="auto">Now go to <a href="http://localhost:8080/actuator" rel="nofollow">http://localhost:8080/actuator</a> to see more actuator end points exposed like below</p>
<div class="highlight highlight-source-json notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content='{"_links":{"self":{"href":"http://localhost:8080/actuator","templated":false},
"beans":{"href":"http://localhost:8080/actuator/beans","templated":false},
"caches-cache":{"href":"http://localhost:8080/actuator/caches/{cache}","templated":true},
"caches":{"href":"http://localhost:8080/actuator/caches","templated":false},
"health-path":{"href":"http://localhost:8080/actuator/health/{*path}","templated":true},
"health":{"href":"http://localhost:8080/actuator/health","templated":false},
"info":{"href":"http://localhost:8080/actuator/info","templated":false},
"conditions":{"href":"http://localhost:8080/actuator/conditions","templated":false},
"configprops":{"href":"http://localhost:8080/actuator/configprops","templated":false},
"configprops-prefix":{"href":"http://localhost:8080/actuator/configprops/{prefix}","templated":true},
"env":{"href":"http://localhost:8080/actuator/env","templated":false},
"env-toMatch":{"href":"http://localhost:8080/actuator/env/{toMatch}","templated":true},
"loggers":{"href":"http://localhost:8080/actuator/loggers","templated":false},
"loggers-name":{"href":"http://localhost:8080/actuator/loggers/{name}","templated":true},
"heapdump":{"href":"http://localhost:8080/actuator/heapdump","templated":false},
"threaddump":{"href":"http://localhost:8080/actuator/threaddump","templated":false},
"metrics":{"href":"http://localhost:8080/actuator/metrics","templated":false},
"metrics-requiredMetricName":{"href":"http://localhost:8080/actuator/metrics/{requiredMetricName}","templated":true},
"scheduledtasks":{"href":"http://localhost:8080/actuator/scheduledtasks","templated":false},
"mappings":{"href":"http://localhost:8080/actuator/mappings","templated":false}}}'><pre>{<span class="pl-ent">"_links"</span>:{<span class="pl-ent">"self"</span>:{<span class="pl-ent">"href"</span>:<span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/actuator<span class="pl-pds">"</span></span>,<span class="pl-ent">"templated"</span>:<span class="pl-c1">false</span>},
<span class="pl-ent">"beans"</span>:{<span class="pl-ent">"href"</span>:<span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/actuator/beans<span class="pl-pds">"</span></span>,<span class="pl-ent">"templated"</span>:<span class="pl-c1">false</span>},
<span class="pl-ent">"caches-cache"</span>:{<span class="pl-ent">"href"</span>:<span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/actuator/caches/{cache}<span class="pl-pds">"</span></span>,<span class="pl-ent">"templated"</span>:<span class="pl-c1">true</span>},
<span class="pl-ent">"caches"</span>:{<span class="pl-ent">"href"</span>:<span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/actuator/caches<span class="pl-pds">"</span></span>,<span class="pl-ent">"templated"</span>:<span class="pl-c1">false</span>},
<span class="pl-ent">"health-path"</span>:{<span class="pl-ent">"href"</span>:<span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/actuator/health/{*path}<span class="pl-pds">"</span></span>,<span class="pl-ent">"templated"</span>:<span class="pl-c1">true</span>},
<span class="pl-ent">"health"</span>:{<span class="pl-ent">"href"</span>:<span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/actuator/health<span class="pl-pds">"</span></span>,<span class="pl-ent">"templated"</span>:<span class="pl-c1">false</span>},
<span class="pl-ent">"info"</span>:{<span class="pl-ent">"href"</span>:<span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/actuator/info<span class="pl-pds">"</span></span>,<span class="pl-ent">"templated"</span>:<span class="pl-c1">false</span>},
<span class="pl-ent">"conditions"</span>:{<span class="pl-ent">"href"</span>:<span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/actuator/conditions<span class="pl-pds">"</span></span>,<span class="pl-ent">"templated"</span>:<span class="pl-c1">false</span>},
<span class="pl-ent">"configprops"</span>:{<span class="pl-ent">"href"</span>:<span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/actuator/configprops<span class="pl-pds">"</span></span>,<span class="pl-ent">"templated"</span>:<span class="pl-c1">false</span>},
<span class="pl-ent">"configprops-prefix"</span>:{<span class="pl-ent">"href"</span>:<span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/actuator/configprops/{prefix}<span class="pl-pds">"</span></span>,<span class="pl-ent">"templated"</span>:<span class="pl-c1">true</span>},
<span class="pl-ent">"env"</span>:{<span class="pl-ent">"href"</span>:<span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/actuator/env<span class="pl-pds">"</span></span>,<span class="pl-ent">"templated"</span>:<span class="pl-c1">false</span>},
<span class="pl-ent">"env-toMatch"</span>:{<span class="pl-ent">"href"</span>:<span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/actuator/env/{toMatch}<span class="pl-pds">"</span></span>,<span class="pl-ent">"templated"</span>:<span class="pl-c1">true</span>},
<span class="pl-ent">"loggers"</span>:{<span class="pl-ent">"href"</span>:<span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/actuator/loggers<span class="pl-pds">"</span></span>,<span class="pl-ent">"templated"</span>:<span class="pl-c1">false</span>},
<span class="pl-ent">"loggers-name"</span>:{<span class="pl-ent">"href"</span>:<span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/actuator/loggers/{name}<span class="pl-pds">"</span></span>,<span class="pl-ent">"templated"</span>:<span class="pl-c1">true</span>},
<span class="pl-ent">"heapdump"</span>:{<span class="pl-ent">"href"</span>:<span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/actuator/heapdump<span class="pl-pds">"</span></span>,<span class="pl-ent">"templated"</span>:<span class="pl-c1">false</span>},
<span class="pl-ent">"threaddump"</span>:{<span class="pl-ent">"href"</span>:<span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/actuator/threaddump<span class="pl-pds">"</span></span>,<span class="pl-ent">"templated"</span>:<span class="pl-c1">false</span>},
<span class="pl-ent">"metrics"</span>:{<span class="pl-ent">"href"</span>:<span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/actuator/metrics<span class="pl-pds">"</span></span>,<span class="pl-ent">"templated"</span>:<span class="pl-c1">false</span>},
<span class="pl-ent">"metrics-requiredMetricName"</span>:{<span class="pl-ent">"href"</span>:<span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/actuator/metrics/{requiredMetricName}<span class="pl-pds">"</span></span>,<span class="pl-ent">"templated"</span>:<span class="pl-c1">true</span>},
<span class="pl-ent">"scheduledtasks"</span>:{<span class="pl-ent">"href"</span>:<span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/actuator/scheduledtasks<span class="pl-pds">"</span></span>,<span class="pl-ent">"templated"</span>:<span class="pl-c1">false</span>},
<span class="pl-ent">"mappings"</span>:{<span class="pl-ent">"href"</span>:<span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/actuator/mappings<span class="pl-pds">"</span></span>,<span class="pl-ent">"templated"</span>:<span class="pl-c1">false</span>}}}</pre></div>
<p dir="auto">As seen above the actuator provides information about beans, env, heapdump, threaddump, metrics etc. In order to get any detailed information click on the link. In case of threaddump click: <a href="http://localhost:8080/actuator/threaddump" rel="nofollow">http://localhost:8080/actuator/threaddump</a></p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://user-images.githubusercontent.com/7569031/233135743-6ba4d395-574b-49a1-880e-f1a52a5d896e.png"><div class="text-center"><img src="https://user-images.githubusercontent.com/7569031/233135743-6ba4d395-574b-49a1-880e-f1a52a5d896e.png" alt="Thread Dump Info" style="max-width: 100%;"></div></a></p>
<br>
<h6 align="center" dir="auto">
<a id="user-content--1" class="anchor" aria-hidden="true" href="custom-actuator-prometheus-metric-for-better-spring-boot-application-monitoring.html#-1"><svg class="octicon octicon-link" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>•     •     •</h6>
<br>
<h3 dir="auto">
<a id="user-content-add-micrometer-prometheus-based-metric-to-the-application" class="anchor" aria-hidden="true" href="custom-actuator-prometheus-metric-for-better-spring-boot-application-monitoring.html#add-micrometer-prometheus-based-metric-to-the-application"><svg class="octicon octicon-link" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Add Micrometer Prometheus based metric to the application</h3>
<p dir="auto">Next to publish the metrics to monitoring tools like Prometheus, Datadog or Dynatrace a standard format is required. Micrometer acts as that intermediate layer to easily interface with the monitoring tools. Prometheus is chosen for this example which is used to perform time series analysis and uses pull based approach. Simply add micrometer prometheus setup to the application by including the below dependency</p>
<p dir="auto">For Maven</p>
<div class="highlight highlight-source-java notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="&lt;dependency&gt;
	&lt;groupId&gt;io.micrometer&lt;/groupId&gt;
	&lt;artifactId&gt;micrometer-registry-prometheus&lt;/artifactId&gt;
	&lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;
"><pre>&lt;<span class="pl-s1">dependency</span>&gt;
	&lt;<span class="pl-s1">groupId</span>&gt;<span class="pl-smi">io</span>.<span class="pl-smi">micrometer</span>&lt;/<span class="pl-smi">groupId</span>&gt;
	&lt;<span class="pl-s1">artifactId</span>&gt;<span class="pl-s1">micrometer</span>-<span class="pl-s1">registry</span>-<span class="pl-s1">prometheus</span>&lt;/<span class="pl-s1">artifactId</span>&gt;
	&lt;<span class="pl-s1">scope</span>&gt;<span class="pl-s1">runtime</span>&lt;/<span class="pl-s1">scope</span>&gt;
&lt;/<span class="pl-s1">dependency</span>&gt;</pre></div>
<p dir="auto">Now run the application again to see the new actuator point - <a href="http://localhost:8080/actuator/prometheus" rel="nofollow">http://localhost:8080/actuator/prometheus</a>.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://user-images.githubusercontent.com/7569031/233418124-8155ef76-19e3-4644-b8bd-7e1e062409e2.png"><div class="text-center"><img src="https://user-images.githubusercontent.com/7569031/233418124-8155ef76-19e3-4644-b8bd-7e1e062409e2.png" alt="Acutuator Prometheus Metrics" style="max-width: 100%;"></div></a></p>
<br>
<h6 align="center" dir="auto">
<a id="user-content--2" class="anchor" aria-hidden="true" href="custom-actuator-prometheus-metric-for-better-spring-boot-application-monitoring.html#-2"><svg class="octicon octicon-link" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>•     •     •</h6>
<br>
<h3 dir="auto">
<a id="user-content-add-custom-metrics-to-micrometer-prometheus" class="anchor" aria-hidden="true" href="custom-actuator-prometheus-metric-for-better-spring-boot-application-monitoring.html#add-custom-metrics-to-micrometer-prometheus"><svg class="octicon octicon-link" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Add custom metrics to micrometer prometheus</h3>
<p dir="auto">Now that the default prometheus metrics are available time to add the custom metrics. Custom metrics can be added in service or business logic classes. Two objects are essential to build the custom metric</p>
<ol dir="auto">
<li>MeterRegistry</li>
<li>Metric Type Object - Counter/Gauge/Timer</li>
</ol>
<ul dir="auto">
<li>Use Spring boot @Autowired annotation to create MeterRegistry</li>
</ul>
<div class="highlight highlight-source-java notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="    @Autowired
    MeterRegistry registry;"><pre>    <span class="pl-c1">@</span><span class="pl-c1">Autowired</span>
    <span class="pl-smi">MeterRegistry</span> <span class="pl-s1">registry</span>;</pre></div>
<ul dir="auto">
<li>Next initialize the metric type in constructor or post construct methods like below</li>
</ul>
<div class="highlight highlight-source-java notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content='@PostConstruct
public void initialize(){
	counter = Counter.builder("custom_counter_metric").register(registry);
	Gauge.builder("custom_gauge_metric",numbersList,Collection::size).register(registry);
	timer = Timer.builder("custom_timer_metric").register(registry);
}'><pre><span class="pl-c1">@</span><span class="pl-c1">PostConstruct</span>
<span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-s1">initialize</span>(){
	<span class="pl-s1">counter</span> = <span class="pl-smi">Counter</span>.<span class="pl-en">builder</span>(<span class="pl-s">"custom_counter_metric"</span>).<span class="pl-en">register</span>(<span class="pl-s1">registry</span>);
	<span class="pl-smi">Gauge</span>.<span class="pl-en">builder</span>(<span class="pl-s">"custom_gauge_metric"</span>,<span class="pl-s1">numbersList</span>,<span class="pl-smi">Collection</span>::<span class="pl-s1">size</span>).<span class="pl-en">register</span>(<span class="pl-s1">registry</span>);
	<span class="pl-s1">timer</span> = <span class="pl-smi">Timer</span>.<span class="pl-en">builder</span>(<span class="pl-s">"custom_timer_metric"</span>).<span class="pl-en">register</span>(<span class="pl-s1">registry</span>);
}</pre></div>
<ul dir="auto">
<li>Record the metrics in methods as follows</li>
</ul>
<div class="highlight highlight-source-java notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="//custom logic
counter.increment();
counter.increment(5);"><pre><span class="pl-c">//custom logic</span>
<span class="pl-s1">counter</span>.<span class="pl-en">increment</span>();
<span class="pl-s1">counter</span>.<span class="pl-en">increment</span>(<span class="pl-c1">5</span>);</pre></div>
<div class="highlight highlight-source-java notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="//custom logic
timer.record(Duration.between(tenMinuteBefore,LocalDateTime.now()).getSeconds(), TimeUnit.SECONDS);"><pre><span class="pl-c">//custom logic</span>
<span class="pl-s1">timer</span>.<span class="pl-en">record</span>(<span class="pl-smi">Duration</span>.<span class="pl-en">between</span>(<span class="pl-s1">tenMinuteBefore</span>,<span class="pl-smi">LocalDateTime</span>.<span class="pl-en">now</span>()).<span class="pl-en">getSeconds</span>(), <span class="pl-smi">TimeUnit</span>.<span class="pl-c1">SECONDS</span>);</pre></div>
<p dir="auto">A sample service class is as follows</p>
<div class="highlight highlight-source-java notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content='@Service
public class DemoService {

    @Autowired
    MeterRegistry registry;

    private Counter counter;

    private ArrayList numbersList = new ArrayList&lt;&gt;();

    private Timer timer;


    @PostConstruct
    public void initialize(){
	counter = Counter.builder("custom_counter_metric").register(registry);
	Gauge.builder("custom_gauge_metric",numbersList,Collection::size).register(registry);
	timer = Timer.builder("custom_timer_metric").register(registry);
     }

    public void incrementCounter() {
        //custom logic
        counter.increment();
        counter.increment(5);
    }

    public void processGauge() {
        numbersList.add(new Random());
    }

    public void recordTime() {
        LocalDateTime tenMinuteBefore = LocalDateTime.now().minusMinutes(10);
        //custom logic
        timer.record(Duration.between(tenMinuteBefore,LocalDateTime.now()).getSeconds(), TimeUnit.SECONDS);
    }
}'><pre><span class="pl-c1">@</span><span class="pl-c1">Service</span>
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-smi">DemoService</span> {

    <span class="pl-c1">@</span><span class="pl-c1">Autowired</span>
    <span class="pl-smi">MeterRegistry</span> <span class="pl-s1">registry</span>;

    <span class="pl-k">private</span> <span class="pl-smi">Counter</span> <span class="pl-s1">counter</span>;

    <span class="pl-k">private</span> <span class="pl-smi">ArrayList</span> <span class="pl-s1">numbersList</span> = <span class="pl-k">new</span> <span class="pl-smi">ArrayList</span>&lt;&gt;();

    <span class="pl-k">private</span> <span class="pl-smi">Timer</span> <span class="pl-s1">timer</span>;


    <span class="pl-c1">@</span><span class="pl-c1">PostConstruct</span>
    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">initialize</span>(){
	<span class="pl-s1">counter</span> = <span class="pl-smi">Counter</span>.<span class="pl-en">builder</span>(<span class="pl-s">"custom_counter_metric"</span>).<span class="pl-en">register</span>(<span class="pl-s1">registry</span>);
	<span class="pl-smi">Gauge</span>.<span class="pl-en">builder</span>(<span class="pl-s">"custom_gauge_metric"</span>,<span class="pl-s1">numbersList</span>,<span class="pl-smi">Collection</span>::<span class="pl-s1">size</span>).<span class="pl-en">register</span>(<span class="pl-s1">registry</span>);
	<span class="pl-s1">timer</span> = <span class="pl-smi">Timer</span>.<span class="pl-en">builder</span>(<span class="pl-s">"custom_timer_metric"</span>).<span class="pl-en">register</span>(<span class="pl-s1">registry</span>);
     }

    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">incrementCounter</span>() {
        <span class="pl-c">//custom logic</span>
        <span class="pl-s1">counter</span>.<span class="pl-en">increment</span>();
        <span class="pl-s1">counter</span>.<span class="pl-en">increment</span>(<span class="pl-c1">5</span>);
    }

    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">processGauge</span>() {
        <span class="pl-s1">numbersList</span>.<span class="pl-en">add</span>(<span class="pl-k">new</span> <span class="pl-smi">Random</span>());
    }

    <span class="pl-k">public</span> <span class="pl-smi">void</span> <span class="pl-en">recordTime</span>() {
        <span class="pl-smi">LocalDateTime</span> <span class="pl-s1">tenMinuteBefore</span> = <span class="pl-smi">LocalDateTime</span>.<span class="pl-en">now</span>().<span class="pl-en">minusMinutes</span>(<span class="pl-c1">10</span>);
        <span class="pl-c">//custom logic</span>
        <span class="pl-s1">timer</span>.<span class="pl-en">record</span>(<span class="pl-smi">Duration</span>.<span class="pl-en">between</span>(<span class="pl-s1">tenMinuteBefore</span>,<span class="pl-smi">LocalDateTime</span>.<span class="pl-en">now</span>()).<span class="pl-en">getSeconds</span>(), <span class="pl-smi">TimeUnit</span>.<span class="pl-c1">SECONDS</span>);
    }
}</pre></div>
<p dir="auto">Once these methods are called navigate to <a href="http://localhost:8080/actuator/prometheus/" rel="nofollow">http://localhost:8080/actuator/prometheus/</a> to see the custom metrics</p>
<div class="highlight highlight-source-java notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# HELP custom_counter_metric_total  
# TYPE custom_counter_metric_total counter
custom_counter_metric_total 6.0"><pre># <span class="pl-smi">HELP</span> <span class="pl-s1">custom_counter_metric_total</span>  
# <span class="pl-c1">TYPE</span> <span class="pl-s1">custom_counter_metric_total</span> <span class="pl-s1">counter</span>
<span class="pl-s1">custom_counter_metric_total</span> <span class="pl-c1">6.0</span></pre></div>
<div class="highlight highlight-source-java notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# HELP custom_gauge_metric  
# TYPE custom_gauge_metric gauge
custom_gauge_metric 1.0"><pre># <span class="pl-smi">HELP</span> <span class="pl-s1">custom_gauge_metric</span>  
# <span class="pl-c1">TYPE</span> <span class="pl-s1">custom_gauge_metric</span> <span class="pl-s1">gauge</span>
<span class="pl-s1">custom_gauge_metric</span> <span class="pl-c1">1.0</span></pre></div>
<div class="highlight highlight-source-java notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# HELP custom_timer_metric_seconds_max  
# TYPE custom_timer_metric_seconds_max gauge
custom_timer_metric_seconds_max 0.0
# HELP custom_timer_metric_seconds  
# TYPE custom_timer_metric_seconds summary
custom_timer_metric_seconds_count 1.0
custom_timer_metric_seconds_sum 600.0"><pre># <span class="pl-smi">HELP</span> <span class="pl-s1">custom_timer_metric_seconds_max</span>  
# <span class="pl-c1">TYPE</span> <span class="pl-s1">custom_timer_metric_seconds_max</span> <span class="pl-s1">gauge</span>
<span class="pl-s1">custom_timer_metric_seconds_max</span> <span class="pl-c1">0.0</span>
# <span class="pl-smi">HELP</span> <span class="pl-s1">custom_timer_metric_seconds</span>  
# <span class="pl-c1">TYPE</span> <span class="pl-s1">custom_timer_metric_seconds</span> <span class="pl-s1">summary</span>
<span class="pl-s1">custom_timer_metric_seconds_count</span> <span class="pl-c1">1.0</span>
<span class="pl-s1">custom_timer_metric_seconds_sum</span> <span class="pl-c1">600.0</span></pre></div>
<p dir="auto">Thus custom metrics are added to the spring boot application. Happy Monitoring !!!</p>
</article></div></body></html>

    </div>
  </div>
  <br>
  <div class="row justify-content-center">
    <h6 class="text-center">&#x2022;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#x2022;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#x2022;</h6>
  </div>
  <br>
  <div class="row justify-content-center contact">
    <div class="text-center">
      Follow Me on:
      <a href="https://medium.com/@ethi"><i class="fab fa-medium"></i> Medium </a>
      <a href="https://www.youtube.com/channel/UCkdAJA03TJXhb_tNjTyl_nA?sub_confirmation=1"><i class="fab fa-youtube"></i> Youtube </a>
      <a href="https://www.instagram.com/ethirajchandru/"><i class="fab fa-instagram"></i> Instagram </a>
      <a href="https://www.linkedin.com/in/ethirajsrinivasan/"><i class="fab fa-linkedin"></i>
      LinkedIn </a>
      <a href="https://github.com/ethirajsrinivasan/"><i class="fab fa-github"></i><span> Github </a>
      <a href="https://twitter.com/iamethi"><i class="fab fa-twitter"></i> Twitter </a>
    </div>
  </div>
  <br>
  <br>
  <div class="row">
    <div class="col">
      <div class="float-start mt-4">
        <div class="project_nav_link">6 Valuable Life Lessons I Learned in My Early 30s</div>
        <a href="6-valuable-life-lessons-i-learned-in-my-early-30s.html">&larr; Previous Blog</a>
      </div>
      <div class="float-end mt-4">
        <div class="project_nav_link">JDK variants: From Sun MicroSystems to Oracle and Beyond</div>
        <a href="jdk-variants-from-sun-microsystems-to-oracle-and-beyond.html">Next Blog &rarr; </a>
      </div>
    </div>
  </div>
  <div id="disqus_thread"></div>
<script>
/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables */
var disqus_config = function () {
  this.shortname = "ethigeek-com";
  this.page.url = "http://ethigeek.com:3000/blogs/custom-actuator-prometheus-metric-for-better-spring-boot-application-monitoring";
  this.page.identifier = 'blog-19';
  this.page.title = 'Custom Actuator Prometheus Metric For Better Spring Boot Application Monitoring'; 
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//ethigeek-com.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</div>
</div>

		<div class="spacer"></div>
		<footer class="footer fixed-bottom">
			<div class="container">
				<ul class="list-inline d-flex justify-content-center">
					<li class="list-inline-item"><a target="_blank" class="fab fa-medium" href="https://medium.com/@ethi"></a></li>
          <li class="list-inline-item"><a target="_blank" class="fab fa-youtube" href="https://www.youtube.com/channel/UCkdAJA03TJXhb_tNjTyl_nA?sub_confirmation=1"></a></li>
          <li class="list-inline-item"><a target="_blank" class="fab fa-instagram" href="https://www.instagram.com/ethirajchandru/"></a></li>
          <li class="list-inline-item"><a target="_blank" class="fab fa-linkedin" href="https://in.linkedin.com/in/ethirajsrinivasan"></a></li>
          <li class="list-inline-item"><a target="_blank" class="fab fa-github" href="https://github.com/ethirajsrinivasan"></a></li>
          <li class="list-inline-item"><a target="_blank" class="fab fa-twitter" href="https://twitter.com/iamethi"></a></li>
				</ul>
			</div>
		</footer>
	</body>
	<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-66415800-8', 'auto');
	ga('send', 'pageview');
	</script>
	<script src="https://cdn.rawgit.com/michalsnik/aos/2.1.1/dist/aos.js"></script>
	<script>
		AOS.init({
			offset: 200,
			duration: 600,
			easing: 'ease-in-sine',
			delay: 100,
		});
	</script>
</html>